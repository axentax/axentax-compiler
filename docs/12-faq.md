# よくある質問・トラブルシューティング

## 概要

conductor APIを使用する際によくある質問とその解決方法を紹介します。

## 基本的な質問

### Q1: conductorとは何ですか？

**A:** conductorは、ギター演奏用の独自音楽記譜シンタックスを解析し、MIDIファイルや演奏情報を生成するTypeScriptライブラリです。コード記譜やタブ譜から、スライド、ベンド、レガートなどの奏法を含むMIDIデータを作成できます。

### Q2: どのような音楽記譜に対応していますか？

**A:** 以下の記譜に対応しています：
- **コード記譜**: `C`, `Dm`, `Em7`などのコード記号
- **タブ譜**: `|||2`, `||||12`などの弦・フレット指定
- **奏法記譜**: スライド、ベンド、レガート、ストローク、ストラムなど
- **マッピング機能**: パターンの繰り返し・変形

### Q3: 対応している楽器は何ですか？

**A:** 主に6弦ギター（標準チューニング）を想定して設計されています。カスタムチューニングやコード辞書を使用することで、他の楽器にも対応可能です。

## 技術的な質問

### Q4: TypeScript以外の言語でも使用できますか？

**A:** conductorはTypeScriptで書かれていますが、コンパイル後のJavaScriptとしても使用できます。Node.js環境が必要です。

### Q5: ブラウザでも動作しますか？

**A:** 現在はNode.js環境での使用を想定しています。ブラウザでの使用には、適切なバンドラー（Webpack、Vite等）での設定が必要です。

### Q6: 処理速度はどの程度ですか？

**A:** 一般的な処理時間は以下の通りです：
- **小規模なsyntax** (10-50行): 50-200ms
- **中規模なsyntax** (50-200行): 200-500ms
- **大規模なsyntax** (200行以上): 500ms以上

## 構文に関する質問

### Q7: 構文エラーが発生します。どうすればよいですか？

**A:** エラーレスポンスには以下の情報が含まれています：
- `message`: エラーメッセージ
- `line`: エラー行番号
- `linePos`: エラー位置
- `token`: エラートークン

これらの情報を確認して、該当箇所を修正してください。

### Q8: 無効なコードが使用されていると警告が出ます

**A:** 存在しないコードを使用した場合、警告メッセージが表示されます。以下の方法で解決できます：
- 正しいコード名を使用する
- カスタムコードを`chordDic`で定義する
- 警告を無視して処理を続行する

### Q9: BPMの範囲はどのくらいですか？

**A:** BPMは1-999の範囲で指定できます。範囲外の値を指定するとエラーが発生します。

### Q10: フレットの範囲はどのくらいですか？

**A:** フレットは0-24の範囲で指定できます。0は開放弦を表します。

## 奏法に関する質問

### Q11: スライドの書き方は？

**A:** 以下の形式で記述します：
```
|||||12:to(continue) |||||15  // 継続スライド
|||||7:to(release) |||||10    // リリーススライド
```

### Q12: ベンドの書き方は？

**A:** 以下の形式で記述します：
```
|||||7:bd(0..1/4 cho 1)       // チョーキング
|||||9:bd(0..2/4 vib 0.5)     // ビブラート
```

### Q13: レガートの書き方は？

**A:** 以下の形式で記述します：
```
|||||5:leg
```

### Q14: ストロークの書き方は？

**A:** 以下の形式で記述します：
```
G:stroke(1/4, down)           // ダウンストローク
C:stroke(1/4, up)             // アップストローク
```

## マッピング機能に関する質問

### Q15: map()の使い方は？

**A:** 以下の形式で記述します：
```
C:map(0..3)                   // 0から3回繰り返し
Dm:map(0..2)                  // 0から2回繰り返し
```

### Q16: step()の使い方は？

**A:** 以下の形式で記述します：
```
|||||5:step(54321):map(0..3)  // フィンガリングパターン
```

### Q17: mapSeedは何のために使いますか？

**A:** mapSeedは、マッピング機能で使用するパターンや値を外部から注入するために使用します。複雑なパターンやテスト用の固定値などを指定できます。

## パフォーマンスに関する質問

### Q18: 処理が遅いです。改善方法はありますか？

**A:** 以下の方法で改善できます：
- `hasMidiBuild: false`にしてMIDI生成をスキップ
- 不要なスタイル解決を避ける
- 大きなsyntaxを分割して処理

### Q19: メモリ使用量を削減する方法はありますか？

**A:** 以下の方法で削減できます：
- 不要なデータを削除
- 大きなオブジェクトの参照を解除
- 処理後にガベージコレクションを実行

## エラーハンドリング

### Q20: エラーハンドリングのベストプラクティスは？

**A:** 以下のパターンを推奨します：

```typescript
try {
  const result = Conductor.convertToObj(/* パラメータ */);
  
  if (result.error) {
    console.error('構文エラー:', result.error.message);
    console.error('行:', result.error.line);
    console.error('位置:', result.error.linePos);
    return;
  }
  
  // 成功時の処理
  console.log('処理時間:', result.compileMsec, 'ms');
  
} catch (error) {
  console.error('予期しないエラー:', error);
}
```

### Q21: 警告メッセージを処理する方法は？

**A:** 以下の方法で処理できます：

```typescript
const result = Conductor.convertToObj(/* パラメータ */);

if (result.conduct?.res.warnings.length > 0) {
  console.warn('警告メッセージ:');
  result.conduct.res.warnings.forEach(warning => {
    console.warn('-', warning);
  });
}
```

## トラブルシューティング

### Q22: "Maximum call stack size exceeded"エラーが発生します

**A:** これは循環参照が原因の可能性があります。現在のバージョンでは、`prevTabObj`と`nextTabObj`の循環参照が発生する場合があります。この問題は将来的に修正予定です。

### Q23: MIDIファイルが生成されません

**A:** 以下の点を確認してください：
- `hasMidiBuild: true`が設定されているか
- 構文エラーがないか
- 有効な音楽要素が含まれているか

### Q24: 期待通りの音が生成されません

**A:** 以下の点を確認してください：
- コード名が正しいか
- フレット位置が適切か
- スタイル設定が正しいか
- チューニング設定が適切か

### Q25: パフォーマンスが悪化しました

**A:** 以下の点を確認してください：
- 構文の複雑さ
- マッピングの回数
- スタイル解決の設定
- システムリソースの使用状況

## サポート

### Q26: バグを報告する方法は？

**A:** 以下の情報を含めて報告してください：
- 使用したsyntax
- エラーメッセージ
- 期待される動作
- 実際の動作
- 環境情報（Node.jsバージョン、OS等）

### Q27: 機能要望を提案する方法は？

**A:** 以下の情報を含めて提案してください：
- 要望する機能の詳細
- 使用例
- 期待される効果
- 優先度

### Q28: ドキュメントが不足しています

**A:** 現在、以下のドキュメントが利用可能です：
- [概要](./overview.md)
- [エンドポイント/メソッド](./endpoints.md)
- [リクエスト仕様](./request.md)
- [レスポンス仕様](./response.md)
- [記譜シンタックス例](./syntax-examples.md)
- [型定義集](./type-definitions.md)

追加のドキュメントが必要な場合は、お知らせください。 