# 接頭辞（Prefix）解説

## 概要

conductorの記譜シンタックスでは、ノートやコードの直前に「接頭辞（prefix）」を付けることで、演奏アクションやニュアンスを指定できます。接頭辞は主にストロークの方向・強度、音の連結、休符・ノイズ、アプローチ奏法などの演奏表現をコントロールするために使われます。

## 主な接頭辞の種類

### 1. ストローク指定

#### 逆ストローク（up picking）
- `!` … 逆ストローク（up picking）を指定（1つのみ有効）
- `!''...` … 逆ストローク＋強度指定（`'`は複数指定可能）

#### 通常ストローク（down picking）
- `''...` … 通常ストローク（down picking）＋強度指定（`'`は複数指定可能）

#### 例
```
!|||2        // 逆ストロークで2フレット
!''|||3      // 逆ストローク＋強度2段階で3フレット
''|||5       // 通常ストローク＋強度2段階で5フレット
```

### 2. 音の連結指定

- `..` … 音をつなげる（レガート的な意味）
- **注意**: コード（C、Dm等）には使用できません。タブ譜（|||2等）のみ有効です。

#### 例
```
..|||2       // 2フレットを前の音とつなげる
..''|||2     // つなげる＋強度指定（強度は無効、つなげるのみ有効）
```

### 3. アプローチ指定

- `>>` … アプローチ奏法を指定
- `!>>` … 逆ストローク＋アプローチ
- `''>>` … 強度指定＋アプローチ

#### アプローチの詳細構文
```
[ストローク指定]?[弦指定][!時間指定]?>>[目標音]
```

**パラメータ**:
- `ストローク指定`: `!`（逆ストローク）、`'`（強度）
- `弦指定`: `|`で区切った弦番号（例：`|2||4`は2弦と4弦）
- `時間指定`: `!`の後の数値（ミリ秒単位）
- `目標音`: アプローチ先の音（タブ譜）

#### 例
```
|||2||4>>|||||12    // 2弦と4弦から12フレットへアプローチ
!|||3>>|||||15      // 逆ストロークで3弦から15フレットへアプローチ
''|||2||4!200>>|||||10  // 強度指定で2弦と4弦から10フレットへ200msでアプローチ
```

**注意**: アプローチ指定では休符（`r`）は使用できません。

### 4. 休符・ノイズ指定

- `r`：休符（音を出さない）
- `R`：ノイズ（弦を弾くノイズ音）

#### 例
```
r           // 休符
R           // ノイズ
```

## 接頭辞の使い方

- 接頭辞はノートやコードの直前に記述します。
- 複数の接頭辞を組み合わせて、より細かい演奏表現が可能です。
- ストロークの強度（`'`の数）は複数指定可能です。

#### 例
```
!|||2:leg      // 逆ストローク＋レガート
..|||2         // 音をつなげる
!''|||2:bd(0..1/4 cho 1)  // 逆ストローク＋強度＋ベンド
|||2||4>>|||||12:approach(80)  // アプローチ＋アプローチ強度指定
```

## 実装上のポイント

- 接頭辞はパース時に自動的に解釈され、該当ノートやコードの演奏情報に反映されます。
- ストロークの方向（up/down）や強度、音の連結、アプローチなど、演奏表現を細かくコントロールできます。
- 接頭辞によって、後続のスタイルやノートの解釈が変化します。

## 注意事項

- `!`は逆ストローク（up picking）を示し、1つのみ有効です。
- `'`はストロークの強度を表し、複数指定可能です。
- `..`は音の連結を示し、コードには使用できません（タブ譜のみ有効）。
- `>>`はアプローチ奏法を示し、休符（`r`）は使用できません。
- 不正な接頭辞や記法はエラーとなる場合があります。
- 接頭辞とスタイル（:以降）は併用可能です。

## 参考例

```typescript
@@ 140 1/4 {
  !|||2
  !''|||3:leg
  ..|||5
  r
  ''|||2:bd(0..1/4 cho 1)
  |||2||4>>|||||12:approach(80)
  !|||3>>|||||15:leg
}
```

これらの接頭辞を活用することで、より表現力豊かなギター演奏を記述できます。 